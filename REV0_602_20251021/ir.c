/*
*******************************************************************************
* COPYRIGHT (c) 1992-2012 GASTRON Co.,Ltd. All rights reserved.
*******************************************************************************
* Model Name	: GTF-1100 Series
* Module name	: 
* Description	: 
* Version		: REV 0.51
* Start Date	: 2017.01.17
* Modify Date	: 2018.06.14
* C-Compiler	: avr-gcc
* MPU			: ATmega1281
* Written by	: Min-Sung, Kang (mskang@gastron.com)
*******************************************************************************
*/

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <math.h>
#include <avr/interrupt.h>
#include <avr/pgmspace.h>

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "global.h"
#include "dbg_printf.h"

#include "ir.h"
#include "uv.h"
#include "uart1281.h"
#include "gpio.h"
#include "adc.h"
#include "mmi.h"
#include "eep.h"
#include "timer.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

U16		IrRaw[2][IR_WL_MAX][IR_BUF_SIZE];
U16		IrRawIndex;
U16		IrDetCnt, IrWarCnt;
U16		IrHiLmt, IrLoLmt, IrDebTime;
double	IrFlickerFactor, IrBitLmt, Ir1sAvrgDvOverLmt;

//non-hydrocarbon 추가
U16		IrSizeLmt_NHC, IrSizeLmtOnNonOperFlame, IrFreqSumLmt, IrDirCntSumLmt, IrTimeDvSumLmt, IrTimeDvSumLmtInCntZr;
U16		IrLoSizeLmtCpsRef_NHC, IrLoSizeLmt_NHC, IrSizeLmtInSizeDvPer;
U16		IrFreqAddCntLmt, IrDirCntLmtInTimeSame, IrTimeDvLmtInFreqSame_NHC;
double	IrSizeDvPerLmt, IrPtoPDvPerLmt;
//

U16		IrSizeLmt;
U8		IrTimeDvLmtInFreqSame;
double	Ir1sAvDvLmtInFreqSame;
U16		IrSizeDvLmtInFreqSame;
U16		IrLoSizeLmtCpsRef, IrFlickerCpsRefLmt;
U16		IrLoSizeLmt;
U8		IrNonDetCnt[IR_WL_MAX];
double	IrAvPtoPMax;
double	IrSpanBuf[IR_WL_MAX][IR_CAL_POINT_MAX], IrSpanVal[IR_WL_MAX][IR_CAL_POINT_MAX], IrSlope[IR_WL_MAX][IR_CAL_POINT_MAX];
U16		IrScale[IR_WL_MAX];
S8		IrRelRatioCorrVal_395,IrRelRatioCorrVal_530;
U16		IrSizeRocLmt;
U16		IrLoDriftChkTick[IR_WL_MAX], IrHiDriftChkTick[IR_WL_MAX];
U16		TripModeIrTimeDvLmt;

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const U8 IrLmtOffset_430[]PROGMEM = {
	0,		//0
	1,		//1
	1,		//2
	1,		//3
	1,		//4
	1,		//5
	2,		//6
	2,		//7
	2,		//8
	2,		//9
	2,		//10
	3,		//11
	3,		//12
	3,		//13
	4,		//14
	5,		//15
	5,		//16
	6,		//17
	7,		//18
	7,		//19
	8,		//20
	9,		//21
	10,		//22
	12,		//23
	13,		//24
	14,		//25
	15,		//26
	17,		//27
	18,		//28
	20,		//29
	22,		//30
	24,		//31
	26,		//32
	28,		//33
	29,		//34
	30,		//35
	31,		//36
	32,		//37
	33,		//38
	34,		//39
	35,		//40
};


const double IR_Rel_Ratio_Limit_395[]PROGMEM = {
	15.0,	// 0
	20.1,	// 1
	20.1,	// 2
	20.1,	// 3
	45.5,	// 4
	63.3,	// 5
	75.8,	// 6
	84.5,	// 7
	90.6,	// 8
	94.9,	// 9
	97.9,	// 10
	92.4,	// 11
	90.1,	// 12
	87.8,	// 13
	85.5,	// 14
	83.2,	// 15
	80.9,	// 16
	78.6,	// 17
	76.3,	// 18
	74.0,	// 19
	71.7,	// 20
	69.4,	// 21
	67.1,	// 22
	64.8,	// 23
	62.5,	// 24
	60.2,	// 25
	57.9,	// 26
	55.6,	// 27
	53.3,	// 28
	51.0,	// 29
	45.5,	// 30
	44.9,	// 31
	44.3,	// 32
	43.7,	// 33
	43.1,	// 34
	42.5,	// 35
	41.9,	// 36
	41.3,	// 37
	41.1,	// 38
	41.0,	// 39
	40.8,	// 40
	40.6,	// 41
	40.5,	// 42
	40.3,	// 43
	40.1,	// 44
	40.0,	// 45
	39.8,	// 46
	39.6,	// 47
	39.5,	// 48
	39.3,	// 49
	39.1,	// 50
	39.0,	// 51
	38.8,	// 52
	38.7,	// 53
	38.5,	// 54
	38.4,	// 55
	38.2,	// 56
	38.1,	// 57
	37.9,	// 58
	37.8,	// 59
	37.6,	// 60
	37.5,	// 61
	37.3,	// 62
	37.2,	// 63
	37.0,	// 64
	36.9,	// 65
	36.7,	// 66
	36.6,	// 67
	36.4,	// 68
	36.3,	// 69
	36.1,	// 70
	36.0,	// 71
	35.8,	// 72
	35.7,	// 73
	35.5,	// 74
	35.4,	// 75
	35.2,	// 76
	35.1,	// 77
	35.0,	// 78
	35.0,	// 79
	35.0,	// 80
	35.0,	// 81
	35.0,	// 82
	35.0,	// 83
	35.0,	// 84
	35.0,	// 85
	35.0,	// 86
	35.0,	// 87
	35.0,	// 88
	35.0,	// 89
	35.0,	// 90
	35.0,	// 91
	35.0,	// 92
	35.0,	// 93
	35.0,	// 94
	35.0,	// 95
	35.0,	// 96
	35.0,	// 97
	35.0,	// 98
	35.0,	// 99
	35.0,	// 100
	35.0,	// 101
	35.0,	// 102
	35.0,	// 103
	35.0,	// 104
	35.0,	// 105
	35.0,	// 106
	35.0,	// 107
	35.0,	// 108
	35.0,	// 109
	35.0,	// 110
	35.0,	// 111
	35.0,	// 112
	35.0,	// 113
	35.0,	// 114
	35.0,	// 115
	35.0,	// 116
	35.0,	// 117
	35.0,	// 118
	35.0,	// 119
	35.0,	// 120
	35.0,	// 121
	35.0,	// 122
	35.0,	// 123
	35.0,	// 124
	35.0,	// 125
	35.0,	// 126
	35.0,	// 127
	35.0,	// 128
	35.0,	// 129
	35.0,	// 130
	35.0,	// 131
	35.0,	// 132
	35.0,	// 133
	35.0,	// 134
	35.0,	// 135
	35.0,	// 136
	35.0,	// 137
	35.0,	// 138
	35.0,	// 139
	35.0,	// 140
	35.0,	// 141
	35.0,	// 142
	35.0,	// 143
	35.0,	// 144
	35.0,	// 145
	35.0,	// 146
	35.0,	// 147
	35.0,	// 148
	35.0,	// 149
	35.0,	// 150
	35.0,	// 151
	35.0,	// 152
	35.0,	// 153
	35.0,	// 154
	35.0,	// 155
	35.0,	// 156
	35.0,	// 157
	35.0,	// 158
	35.0,	// 159
	35.0,	// 160
	35.0,	// 161
	35.0,	// 162
	35.0,	// 163
	35.0,	// 164
	35.0,	// 165
	35.0,	// 166
	35.0,	// 167
	35.0,	// 168
	35.0,	// 169
	35.0,	// 170
	35.0,	// 171
	35.0,	// 172
	35.0,	// 173
	35.0,	// 174
	35.0,	// 175
	35.0,	// 176
	35.0,	// 177
	35.0,	// 178
	35.0,	// 179
	35.0,	// 180
	35.0,	// 181
	35.0,	// 182
	35.0,	// 183
	35.0,	// 184
	35.0,	// 185
	35.0,	// 186
	35.0,	// 187
	35.0,	// 188
	35.0,	// 189
	35.0,	// 190
	35.0,	// 191
	35.0,	// 192
	35.0,	// 193
	35.0,	// 194
	35.0,	// 195
	35.0,	// 196
	35.0,	// 197
	35.0,	// 198
	35.0,	// 199
	35.0,	// 200
	35.0,	// 201
	35.0,	// 202
	35.0,	// 203
	35.0,	// 204
	35.0,	// 205
	35.0,	// 206
	35.0,	// 207
	35.0,	// 208
	35.0,	// 209
	35.0,	// 210
	35.0,	// 211
	35.0,	// 212
	35.0,	// 213
	35.0,	// 214
	35.0,	// 215
	35.0,	// 216
	35.0,	// 217
	35.0,	// 218
	35.0,	// 219
	35.0,	// 220
	35.0,	// 221
	35.0,	// 222
	35.0,	// 223
	35.0,	// 224
	35.0,	// 225
	35.0,	// 226
	35.0,	// 227
	35.0,	// 228
	35.0,	// 229
	35.0,	// 230
	35.0,	// 231
	35.0,	// 232
	35.0,	// 233
	35.0,	// 234
	35.0,	// 235
	35.0,	// 236
	35.0,	// 237
	35.0,	// 238
	35.0,	// 239
	35.0,	// 240
	35.0,	// 241
	35.0,	// 242
	35.0,	// 243
	35.0,	// 244
	35.0,	// 245
	35.0,	// 246
	35.0,	// 247
	35.0,	// 248
	35.0,	// 249
	35.0,	// 250
	35.0,	// 251
	35.0,	// 252
	35.0,	// 253
	35.0,	// 254
	35.0,	// 255
	35.0,	// 256
	35.0,	// 257
	35.0,	// 258
	35.0,	// 259
	35.0,	// 260
	35.0,	// 261
	35.0,	// 262
	35.0,	// 263
	35.0,	// 264
	35.0,	// 265
	35.0,	// 266
	35.0,	// 267
	35.0,	// 268
	35.0,	// 269
	35.0,	// 270
	35.0,	// 271
	35.0,	// 272
	35.0,	// 273
	35.0,	// 274
	35.0,	// 275
	35.0,	// 276
	35.0,	// 277
	35.0,	// 278
	35.0,	// 279
	35.0,	// 280
	35.0,	// 281
	35.0,	// 282
	35.0,	// 283
	35.0,	// 284
	35.0,	// 285
	35.0,	// 286
	35.0,	// 287
	35.0,	// 288
	35.0,	// 289
	35.0,	// 290
	35.0,	// 291
	35.0,	// 292
	35.0,	// 293
	35.0,	// 294
	35.0,	// 295
	35.0,	// 296
	35.0,	// 297
	35.0,	// 298
	35.0,	// 299
	35.0,	// 300
   	35.0,	// 301
	35.0,	// 302
	35.0,	// 303
	35.0,	// 304
	35.0,	// 305
	35.0,	// 306
	35.0,	// 307
	35.0,	// 308
	35.0,	// 309
	35.0,	// 310
	35.0,	// 311
	35.0,	// 312
	35.0,	// 313
	35.0,	// 314
	35.0,	// 315
	35.0,	// 316
	35.0,	// 317
	35.0,	// 318
	35.0,	// 319
	35.0,	// 320
	35.0,	// 321
	35.0,	// 322
	35.0,	// 323
	35.0,	// 324
	35.0,	// 325
	35.0,	// 326
	35.0,	// 327
	35.0,	// 328
	35.0,	// 329
	35.0,	// 330
	35.0,	// 331
	35.0,	// 332
	35.0,	// 333
	35.0,	// 334
	35.0,	// 335
	35.0,	// 336
	35.0,	// 337
	35.0,	// 338
	35.0,	// 339
	35.0,	// 340
	35.0,	// 341
	35.0,	// 342
	35.0,	// 343
	35.0,	// 344
	35.0,	// 345
	35.0,	// 346
	35.0,	// 347
	35.0,	// 348
	35.0,	// 349
	35.0,	// 350
	35.0,	// 351
	35.0,	// 352
	35.0,	// 353
	35.0,	// 354
	35.0,	// 355
	35.0,	// 356
	35.0,	// 357
	35.0,	// 358
	35.0,	// 359
	35.0,	// 360
	35.0,	// 361
	35.0,	// 362
	35.0,	// 363
	35.0,	// 364
	35.0,	// 365
	35.0,	// 366
	35.0,	// 367
	35.0,	// 368
	35.0,	// 369
	35.0,	// 370
	35.0,	// 371
	35.0,	// 372
	35.0,	// 373
	35.0,	// 374
	35.0,	// 375
	35.0,	// 376
	35.0,	// 377
	35.0,	// 378
	35.0,	// 379
	35.0,	// 380
	35.0,	// 381
	35.0,	// 382
	35.0,	// 383
	35.0,	// 384
	35.0,	// 385
	35.0,	// 386
	35.0,	// 387
	35.0,	// 388
	35.0,	// 389
	35.0,	// 390
	35.0,	// 391
	35.0,	// 392
	35.0,	// 393
	35.0,	// 394
	35.0,	// 395
	35.0,	// 396
	35.0,	// 397
	35.0,	// 398
	35.0,	// 399
	35.0,	// 400
	35.0,	// 401
	35.0,	// 402
	35.0,	// 403
	35.0,	// 404
	35.0,	// 405
	35.0,	// 406
	35.0,	// 407
	35.0,	// 408
	35.0,	// 409
	35.0,	// 410
	35.0,	// 411
	35.0,	// 412
	35.0,	// 413
	35.0,	// 414
	35.0,	// 415
	35.0,	// 416
	35.0,	// 417
	35.0,	// 418
	35.0,	// 419
	35.0,	// 420
	35.0,	// 421
	35.0,	// 422
	35.0,	// 423
	35.0,	// 424
	35.0,	// 425
	35.0,	// 426
	35.0,	// 427
	35.0,	// 428
	35.0,	// 429
	35.0,	// 430
	35.0,	// 431
	35.0,	// 432
	35.0,	// 433
	35.0,	// 434
	35.0,	// 435
	35.0,	// 436
	35.0,	// 437
	35.0,	// 438
	35.0,	// 439
	35.0,	// 440
	35.0,	// 441
	35.0,	// 442
	35.0,	// 443
	35.0,	// 444
	35.0,	// 445
	35.0,	// 446
	35.0,	// 447
	35.0,	// 448
	35.0,	// 449
	35.0,	// 450
	35.0,	// 451
	35.0,	// 452
	35.0,	// 453
	35.0,	// 454
	35.0,	// 455
	35.0,	// 456
	35.0,	// 457
	35.0,	// 458
	35.0,	// 459
	35.0,	// 460
	35.0,	// 461
	35.0,	// 462
	35.0,	// 463
	35.0,	// 464
	35.0,	// 465
	35.0,	// 466
	35.0,	// 467
	35.0,	// 468
	35.0,	// 469
	35.0,	// 470
	35.0,	// 471
	35.0,	// 472
	35.0,	// 473
	35.0,	// 474
	35.0,	// 475
	35.0,	// 476
	35.0,	// 477
	35.0,	// 478
	35.0,	// 479
	35.0,	// 480
	35.0,	// 481
	35.0,	// 482
	35.0,	// 483
	35.0,	// 484
	35.0,	// 485
	35.0,	// 486
	35.0,	// 487
	35.0,	// 488
	35.0,	// 489
	35.0,	// 490
	35.0,	// 491
	35.0,	// 492
	35.0,	// 493
	35.0,	// 494
	35.0,	// 495
	35.0,	// 496
	35.0,	// 497
	35.0,	// 498
	35.0,	// 499
	35.0,	// 500
	35.0,	// 501
	35.0,	// 502
	35.0,	// 503
	35.0,	// 504
	35.0,	// 505
	35.0,	// 506
	35.0,	// 507
	35.0,	// 508
	35.0,	// 509
	35.0,	// 510
	35.0,	// 511
	35.0,	// 512
	35.0,	// 513
	35.0,	// 514
	35.0,	// 515
	35.0,	// 516
	35.0,	// 517
	35.1,	// 518
	35.1,	// 519
	35.1,	// 520
	35.1,	// 521
	35.1,	// 522
	35.2,	// 523
	35.2,	// 524
	35.2,	// 525
	35.2,	// 526
	35.3,	// 527
	35.3,	// 528
	35.3,	// 529
	35.3,	// 530
	35.3,	// 531
	35.4,	// 532
	35.4,	// 533
	35.4,	// 534
	35.4,	// 535
	35.5,	// 536
	35.5,	// 537
	35.5,	// 538
	35.5,	// 539
	35.6,	// 540
	35.6,	// 541
	35.6,	// 542
	35.6,	// 543
	35.7,	// 544
	35.7,	// 545
	35.7,	// 546
	35.8,	// 547
	35.8,	// 548
	35.8,	// 549
	35.8,	// 550
	35.9,	// 551
	35.9,	// 552
	35.9,	// 553
	36.0,	// 554
	36.0,	// 555
	36.0,	// 556
	36.1,	// 557
	36.1,	// 558
	36.1,	// 559
	36.1,	// 560
	36.2,	// 561
	36.2,	// 562
	36.2,	// 563
	36.3,	// 564
	36.3,	// 565
	36.3,	// 566
	36.4,	// 567
	36.4,	// 568
	36.4,	// 569
	36.5,	// 570
	36.5,	// 571
	36.6,	// 572
	36.6,	// 573
	36.6,	// 574
	36.7,	// 575
	36.7,	// 576
	36.7,	// 577
	36.8,	// 578
	36.8,	// 579
	36.9,	// 580
	36.9,	// 581
	36.9,	// 582
	37.0,	// 583
	37.0,	// 584
	37.1,	// 585
	37.1,	// 586
	37.1,	// 587
	37.2,	// 588
	37.2,	// 589
	37.3,	// 590
	37.3,	// 591
	37.3,	// 592
	37.4,	// 593
	37.4,	// 594
	37.5,	// 595
	37.5,	// 596
	37.6,	// 597
	37.6,	// 598
	37.7,	// 599
	37.7,	// 600
	37.7,	// 601
	37.8,	// 602
	37.8,	// 603
	37.9,	// 604
	37.9,	// 605
	38.0,	// 606
	38.0,	// 607
	38.1,	// 608
	38.1,	// 609
	38.2,	// 610
	38.2,	// 611
	38.3,	// 612
	38.3,	// 613
	38.4,	// 614
	38.4,	// 615
	38.5,	// 616
	38.6,	// 617
	38.6,	// 618
	38.7,	// 619
	38.7,	// 620
	38.8,	// 621
	38.8,	// 622
	38.9,	// 623
	38.9,	// 624
	39.0,	// 625
	39.1,	// 626
	39.1,	// 627
	39.2,	// 628
	39.2,	// 629
	39.3,	// 630
	39.4,	// 631
	39.4,	// 632
	39.5,	// 633
	39.5,	// 634
	39.6,	// 635
	39.7,	// 636
	39.7,	// 637
	39.8,	// 638
	39.8,	// 639
	39.9,	// 640
	40.0,	// 641
	40.0,	// 642
	40.1,	// 643
	40.2,	// 644
	40.2,	// 645
	40.3,	// 646
	40.4,	// 647
	40.4,	// 648
	40.5,	// 649
	40.6,	// 650
	40.7,	// 651
	40.7,	// 652
	40.8,	// 653
	40.9,	// 654
	40.9,	// 655
	41.0,	// 656
	41.1,	// 657
	41.2,	// 658
	41.2,	// 659
	41.3,	// 660
	41.4,	// 661
	41.5,	// 662
	41.5,	// 663
	41.6,	// 664
	41.7,	// 665
	41.8,	// 666
	41.9,	// 667
	41.9,	// 668
	42.0,	// 669
	42.1,	// 670
	42.2,	// 671
	42.3,	// 672
	42.4,	// 673
	42.4,	// 674
	42.5,	// 675
	42.6,	// 676
	42.7,	// 677
	42.8,	// 678
	42.9,	// 679
	43.0,	// 680
	43.0,	// 681
	43.1,	// 682
	43.2,	// 683
	43.3,	// 684
	43.4,	// 685
	43.5,	// 686
	43.6,	// 687
	43.7,	// 688
	43.8,	// 689
	43.9,	// 690
	44.0,	// 691
	44.1,	// 692
	44.2,	// 693
	44.2,	// 694
	44.3,	// 695
	44.4,	// 696
	44.5,	// 697
	44.6,	// 698
	44.7,	// 699
	44.8,	// 700
	44.9,	// 701
	45.0,	// 702
	45.2,	// 703
	45.3,	// 704
	45.4,	// 705
	45.5,	// 706
	45.6,	// 707
	45.7,	// 708
	45.8,	// 709
	45.9,	// 710
	46.0,	// 711
	46.1,	// 712
	46.2,	// 713
	46.3,	// 714
	46.5,	// 715
	46.6,	// 716
	46.7,	// 717
	46.8,	// 718
	46.9,	// 719
	47.0,	// 720
	47.1,	// 721
	47.3,	// 722
	47.4,	// 723
	47.5,	// 724
	47.6,	// 725
	47.7,	// 726
	47.9,	// 727
	48.0,	// 728
	48.1,	// 729
	48.2,	// 730
	48.4,	// 731
	48.5,	// 732
	48.6,	// 733
	48.7,	// 734
	48.8,	// 735
	48.9,	// 736
	49.0,	// 737
	49.2,	// 738
	49.3,	// 739
	49.4,	// 740
	49.5,	// 741
	49.6,	// 742
	49.7,	// 743
	49.9,	// 744
	50.0,	// 745
	50.1,	// 746
	50.2,	// 747
	50.3,	// 748
	50.5,	// 749
	50.6,	// 750
	50.7,	// 751
	50.8,	// 752
	51.0,	// 753
	51.1,	// 754
	51.2,	// 755
	51.4,	// 756
	51.5,	// 757
	51.6,	// 758
	51.8,	// 759
	51.9,	// 760
	52.0,	// 761
	52.2,	// 762
	52.3,	// 763
	52.4,	// 764
	52.6,	// 765
	52.7,	// 766
	52.8,	// 767
	53.0,	// 768
	53.1,	// 769
	53.3,	// 770
	53.4,	// 771
	53.6,	// 772
	53.7,	// 773
	53.9,	// 774
	54.0,	// 775
	54.1,	// 776
	54.3,	// 777
	54.4,	// 778
	54.6,	// 779
	54.8,	// 780
	54.9,	// 781
	55.1,	// 782
	55.2,	// 783
	55.4,	// 784
	55.5,	// 785
	55.7,	// 786
	55.8,	// 787
	56.0,	// 788
	56.2,	// 789
	56.3,	// 790
	56.5,	// 791
	56.7,	// 792
	56.8,	// 793
	57.0,	// 794
	57.2,	// 795
	57.3,	// 796
	57.5,	// 797
	57.7,	// 798
	57.8,	// 799
	58.0,	// 800
	58.2,	// 801
	58.4,	// 802
	58.5,	// 803
	58.7,	// 804
	58.9,	// 805
	59.1,	// 806
	59.3,	// 807
	59.4,	// 808
	59.6,	// 809
	59.8,	// 810
	60.0,	// 811
	60.2,	// 812
	60.4,	// 813
	60.6,	// 814
	60.8,	// 815
	60.9,	// 816
	61.1,	// 817
	61.3,	// 818
	61.5,	// 819
	61.7,	// 820
	61.9,	// 821
	62.1,	// 822
	62.3,	// 823
	62.5,	// 824
	62.7,	// 825
	62.9,	// 826
	63.1,	// 827
	63.3,	// 828
	63.5,	// 829
	63.7,	// 830
	64.0,	// 831
	64.2,	// 832
	64.4,	// 833
	64.6,	// 834
	64.8,	// 835
	65.0,	// 836
	65.2,	// 837
	65.5,	// 838
	65.6,	// 839
	65.8,	// 840
	66.0,	// 841
	66.2,	// 842
	66.4,	// 843
	66.6,	// 844
	66.8,	// 845
	67.0,	// 846
	67.2,	// 847
	67.4,	// 848
	67.6,	// 849
	67.8,	// 850
	68.0,	// 851
	68.2,	// 852
	68.4,	// 853
	68.6,	// 854
	68.8,	// 855
	69.0,	// 856
	69.2,	// 857
	69.4,	// 858
	69.6,	// 859
	69.8,	// 860
	70.0,	// 861
	70.2,	// 862
	70.4,	// 863
	70.6,	// 864
	70.8,	// 865
	71.0,	// 866
	71.2,	// 867
	71.4,	// 868
	71.6,	// 869
	71.8,	// 870
	72.0,	// 871
	72.2,	// 872
	72.4,	// 873
	72.6,	// 874
	72.8,	// 875
	73.0,	// 876
	73.2,	// 877
	73.4,	// 878
	73.6,	// 879
	73.8,	// 880
	74.0,	// 881
	74.2,	// 882
	74.4,	// 883
	74.6,	// 884
	74.8,	// 885
	75.0,	// 886
	75.2,	// 887
	75.4,	// 888
	75.6,	// 889
	75.8,	// 890
	76.0,	// 891
	76.2,	// 892
	76.4,	// 893
	76.6,	// 894
	76.8,	// 895
	77.0,	// 896
	77.2,	// 897
	77.4,	// 898
	77.6,	// 899
	77.8,	// 900
	78.0,	// 901
	78.2,	// 902
	78.4,	// 903
	78.6,	// 904
	78.8,	// 905
	79.0,	// 906
	79.2,	// 907
	79.4,	// 908
	79.6,	// 909
	79.8,	// 910
	80.0,	// 911
	80.3,	// 912
	80.6,	// 913
	80.9,	// 914
	81.2,	// 915
	81.5,	// 916
	81.8,	// 917
	82.1,	// 918
	82.4,	// 919
	82.7,	// 920
	83.0,	// 921
	83.3,	// 922
	83.6,	// 923
	83.9,	// 924
	84.2,	// 925
	84.5,	// 926
	84.8,	// 927
	85.1,	// 928
	85.4,	// 929
	85.7,	// 930
	86.0,	// 931
	86.3,	// 932
	86.6,	// 933
	86.9,	// 934
	87.2,	// 935
	87.5,	// 936
	87.8,	// 937
	88.1,	// 938
	88.4,	// 939
	88.7,	// 940
	89.0,	// 941
	89.3,	// 942
	89.6,	// 943
	89.9,	// 944
	90.2,	// 945
	90.5,	// 946
	90.8,	// 947
	91.1,	// 948
	91.4,	// 949
	91.7,	// 950
	92.0,	// 951
	92.3,	// 952
	92.6,	// 953
	92.9,	// 954
	93.2,	// 955
	93.5,	// 956
	93.8,	// 957
	94.1,	// 958
	94.4,	// 959
	94.7,	// 960
	95.0,	// 961
	95.3,	// 962
	95.6,	// 963
	95.9,	// 964
	96.2,	// 965
	96.5,	// 966
	96.7,	// 967
	96.9,	// 968
	97.1,	// 969
	97.3,	// 970
	97.5,	// 971
	97.7,	// 972
	97.9,	// 973
	98.1,	// 974
	98.3,	// 975
	98.5,	// 976
	98.7,	// 977
	98.9,	// 978
	99.1,	// 979
	99.2,	// 980
	99.3,	// 981
	99.4,	// 982
	99.5,	// 983
	99.6,	// 984
	99.7,	// 985
	99.8,	// 986
	99.8,	// 987
	99.8,	// 988
	99.8,	// 989
	99.8,	// 990
	99.8,	// 991
	99.8,	// 992
	99.8,	// 993
	99.8,	// 994
	99.8,	// 995
	99.8,	// 996
	99.8,	// 997
	99.8,	// 998
	99.8,	// 999
	99.8    // 1000	 

};
	
const double IR_Rel_Ratio_Limit_530[]PROGMEM = {
	10.0, // 0
	10.1, // 1
	10.1, // 2
	10.1, // 3
	37.0, // 4
	55.9, // 5
	69.1, // 6
	78.3, // 7
	84.8, // 8
	89.3, // 9
	86.6, // 10
	79.7, // 11 
	73.3, // 12 
	72.1, // 13 
	67.6, // 14 
	63.4, // 15 
	59.4, // 16 
	55.7, // 17 
	54.0, // 18 
	52.0, // 19 
	50.0, // 20 
	47.8, // 21 
	45.8, // 22 
	43.8, // 23 
	41.9, // 24 
	40.2, // 25 
	39.6, // 26 
	38.8, // 27 
	37.9, // 28 
	36.8, // 29 
	35.8, // 30 
	34.7, // 31 
	33.7, // 32 
	32.6, // 33 
	31.7, // 34 
	30.7, // 35 
	29.8, // 36 
	29.8, // 37 
	28.7, // 38 
	27.8, // 39 
	27.0, // 40 
	26.9, // 41 
	26.7, // 42 
	26.3, // 43 
	26.6, // 44 
	25.3, // 45 
	24.9, // 46 
	24.4, // 47 
	24.0, // 48 
	23.6, // 49 
	23.2, // 50 
	22.8, // 51 
	22.4, // 52 
	21.9, // 53 
	21.6, // 54 
	21.3, // 55 
	21.0, // 56 
	21.0, // 57 
	20.9, // 58 
	20.9, // 59 
	20.9, // 60 
	20.9, // 61 
	20.8, // 62 
	20.8, // 63 
	20.8, // 64 
	20.7, // 65 
	20.7, // 66 
	20.7, // 67 
	20.6, // 68 
	20.6, // 69 
	20.6, // 70 
	20.5, // 71 
	20.5, // 72 
	20.5, // 73 
	20.4, // 74 
	20.4, // 75 
	20.4, // 76 
	20.3, // 77 
	20.3, // 78 
	20.3, // 79 
	20.2, // 80 
	20.2, // 81 
	20.2, // 82 
	20.1, // 83 
	20.1, // 84 
	20.1, // 85 
	20.0, // 86 
	20.0, // 87 
	20.0, // 88 
	20.0, // 89 
	20.0, // 90 
	20.0, // 91 
	20.0, // 92 
	20.0, // 93 
	20.0, // 94 
	20.0, // 95 
	20.0, // 96 
	20.0, // 97 
	20.0, // 98 
	20.0, // 99 
	20.0, // 100
	20.0, // 101
	20.0, // 102
	20.0, // 103
	20.0, // 104
	20.0, // 105
	20.0, // 106
	20.0, // 107
	20.0, // 108
	20.0, // 109
	20.0, // 110
	20.0, // 111
	20.0, // 112
	20.0, // 113
	20.0, // 114
	20.0, // 115
	20.0, // 116
	20.0, // 117
	20.0, // 118
	20.0, // 119
	20.0, // 120
	20.0, // 121
	20.0, // 122
	20.0, // 123
	20.0, // 124
	20.0, // 125
	20.0, // 126
	20.0, // 127
	20.0, // 128
	20.0, // 129
	20.0, // 130
	20.0, // 131
	20.0, // 132
	20.0, // 133
	20.0, // 134
	20.0, // 135
	20.0, // 136
	20.0, // 137
	20.0, // 138
	20.0, // 139
	20.0, // 140
	20.0, // 141
	20.0, // 142
	20.0, // 143
	20.0, // 144
	20.0, // 145
	20.0, // 146
	20.0, // 147
	20.0, // 148
	20.0, // 149
	20.0, // 150
	20.0, // 151
	20.0, // 152
	20.0, // 153
	20.0, // 154
	20.0, // 155
	20.0, // 156
	20.0, // 157
	20.0, // 158
	20.0, // 159
	20.0, // 160
	20.0, // 161
	20.0, // 162
	20.0, // 163
	20.0, // 164
	20.0, // 165
	20.0, // 166
	20.0, // 167
	20.0, // 168
	20.0, // 169
	20.0, // 170
	20.0, // 171
	20.0, // 172
	20.0, // 173
	20.0, // 174
	20.0, // 175
	20.0, // 176
	20.0, // 177
	20.0, // 178
	20.0, // 179
	20.0, // 180
	20.0, // 181
	20.0, // 182
	20.0, // 183
	20.0, // 184
	20.0, // 185
	20.0, // 186
	20.0, // 187
	20.0, // 188
	20.0, // 189
	20.0, // 190
	20.0, // 191
	20.0, // 192
	20.0, // 193
	20.0, // 194
	20.0, // 195
	20.0, // 196
	20.0, // 197
	20.0, // 198
	20.0, // 199
	20.0, // 200
	20.0, // 201
	20.0, // 202
	20.0, // 203
	20.0, // 204
	20.0, // 205
	20.0, // 206
	20.0, // 207
	20.0, // 208
	20.0, // 209
	20.0, // 210
	20.0, // 211
	20.0, // 212
	20.0, // 213
	20.0, // 214
	20.0, // 215
	20.0, // 216
	20.0, // 217
	20.0, // 218
	20.0, // 219
	20.0, // 220
	20.0, // 221
	20.0, // 222
	20.0, // 223
	20.0, // 224
	20.0, // 225
	20.0, // 226
	20.0, // 227
	20.0, // 228
	20.0, // 229
	20.0, // 230
	20.0, // 231
	20.0, // 232
	20.0, // 233
	20.0, // 234
	20.0, // 235
	20.0, // 236
	20.0, // 237
	20.0, // 238
	20.0, // 239
	20.0, // 240
	20.0, // 241
	20.0, // 242
	20.0, // 243
	20.0, // 244
	20.0, // 245
	20.0, // 246
	20.0, // 247
	20.0, // 248
	20.0, // 249
	20.0, // 250
	20.0, // 251
	20.0, // 252
	20.0, // 253
	20.0, // 254
	20.0, // 255
	20.0, // 256
	20.0, // 257
	20.0, // 258
	20.0, // 259
	20.0, // 260
	20.0, // 261
	20.0, // 262
	20.0, // 263
	20.0, // 264
	20.0, // 265
	20.0, // 266
	20.0, // 267
	20.0, // 268
	20.0, // 269
	20.0, // 270
	20.0, // 271
	20.0, // 272
	20.0, // 273
	20.0, // 274
	20.0, // 275
	20.0, // 276
	20.0, // 277
	20.0, // 278
	20.0, // 279
	20.0, // 280
	20.0, // 281
	20.0, // 282
	20.0, // 283
	20.0, // 284
	20.0, // 285
	20.0, // 286
	20.0, // 287
	20.0, // 288
	20.0, // 289
	20.0, // 290
	20.0, // 291
	20.0, // 292
	20.0, // 293
	20.0, // 294
	20.0, // 295
	20.0, // 296
	20.0, // 297
	20.0, // 298
	20.0, // 299
	20.0, // 300
	20.0, // 301
	20.0, // 302
	20.0, // 303
	20.0, // 304
	20.0, // 305
	20.0, // 306
	20.0, // 307
	20.0, // 308
	20.0, // 309
	20.0, // 310
	20.0, // 311
	20.0, // 312
	20.0, // 313
	20.0, // 314
	20.0, // 315
	20.0, // 316
	20.0, // 317
	20.0, // 318
	20.0, // 319
	20.0, // 320
	20.0, // 321
	20.0, // 322
	20.0, // 323
	20.0, // 324
	20.0, // 325
	20.0, // 326
	20.0, // 327
	20.0, // 328
	20.0, // 329
	20.0, // 330
	20.0, // 331
	20.0, // 332
	20.0, // 333
	20.0, // 334
	20.0, // 335
	20.0, // 336
	20.0, // 337
	20.0, // 338
	20.0, // 339
	20.0, // 340
	20.0, // 341
	20.0, // 342
	20.0, // 343
	20.0, // 344
	20.0, // 345
	20.0, // 346
	20.0, // 347
	20.0, // 348
	20.0, // 349
	20.0, // 350
	20.0, // 351
	20.0, // 352
	20.0, // 353
	20.0, // 354
	20.0, // 355
	20.0, // 356
	20.0, // 357
	20.0, // 358
	20.0, // 359
	20.0, // 360
	20.0, // 361
	20.0, // 362
	20.0, // 363
	20.0, // 364
	20.0, // 365
	20.0, // 366
	20.0, // 367
	20.0, // 368
	20.0, // 369
	20.0, // 370
	20.0, // 371
	20.0, // 372
	20.0, // 373
	20.0, // 374
	20.0, // 375
	20.0, // 376
	20.0, // 377
	20.0, // 378
	20.0, // 379
	20.0, // 380
	20.0, // 381
	20.0, // 382
	20.0, // 383
	20.0, // 384
	20.0, // 385
	20.0, // 386
	20.0, // 387
	20.0, // 388
	20.0, // 389
	20.0, // 390
	20.0, // 391
	20.0, // 392
	20.0, // 393
	20.0, // 394
	20.0, // 395
	20.0, // 396
	20.0, // 397
	20.0, // 398
	20.0, // 399
	20.0, // 400
	20.0, // 401
	20.0, // 402
	20.0, // 403
	20.0, // 404
	20.0, // 405
	20.0, // 406
	20.0, // 407
	20.0, // 408
	20.0, // 409
	20.0, // 410
	20.0, // 411
	20.0, // 412
	20.0, // 413
	20.0, // 414
	20.0, // 415
	20.0, // 416
	20.0, // 417
	20.0, // 418
	20.0, // 419
	20.0, // 420
	20.0, // 421
	20.0, // 422
	20.0, // 423
	20.0, // 424
	20.0, // 425
	20.0, // 426
	20.0, // 427
	20.0, // 428
	20.0, // 429
	20.0, // 430
	20.0, // 431
	20.0, // 432
	20.0, // 433
	20.0, // 434
	20.0, // 435
	20.0, // 436
	20.0, // 437
	20.0, // 438
	20.0, // 439
	20.0, // 440
	20.0, // 441
	20.0, // 442
	20.0, // 443
	20.0, // 444
	20.0, // 445
	20.0, // 446
	20.0, // 447
	20.0, // 448
	20.0, // 449
	20.0, // 450
	20.0, // 451
	20.0, // 452
	20.0, // 453
	20.0, // 454
	20.0, // 455
	20.0, // 456
	20.0, // 457
	20.0, // 458
	20.0, // 459
	20.0, // 460
	20.0, // 461
	20.0, // 462
	20.0, // 463
	20.0, // 464
	20.0, // 465
	20.0, // 466
	20.0, // 467
	20.0, // 468
	20.0, // 469
	20.0, // 470
	20.0, // 471
	20.0, // 472
	20.0, // 473
	20.1, // 474
	20.1, // 475
	20.1, // 476
	20.2, // 477
	20.2, // 478
	20.2, // 479
	20.2, // 480
	20.3, // 481
	20.3, // 482
	20.3, // 483
	20.4, // 484
	20.4, // 485
	20.4, // 486
	20.5, // 487
	20.5, // 488
	20.5, // 489
	20.6, // 490
	20.6, // 491
	20.6, // 492
	20.7, // 493
	20.7, // 494
	20.7, // 495
	20.8, // 496
	20.8, // 497
	20.8, // 498
	20.9, // 499
	20.9, // 500
	20.9, // 501
	21.0, // 502
	21.0, // 503
	21.0, // 504
	21.1, // 505
	21.1, // 506
	21.1, // 507
	21.2, // 508
	21.2, // 509
	21.2, // 510
	21.3, // 511
	21.3, // 512
	21.3, // 513
	21.4, // 514
	21.4, // 515
	21.4, // 516
	21.5, // 517
	21.5, // 518
	21.5, // 519
	21.6, // 520
	21.6, // 521
	21.6, // 522
	21.7, // 523
	21.7, // 524
	21.7, // 525
	21.8, // 526
	21.8, // 527
	21.8, // 528
	21.9, // 529
	21.9, // 530
	21.9, // 531
	22.0, // 532
	22.0, // 533
	22.0, // 534
	22.1, // 535
	22.1, // 536
	22.1, // 537
	22.2, // 538
	22.2, // 539
	22.2, // 540
	22.3, // 541
	22.3, // 542
	22.3, // 543
	22.4, // 544
	22.4, // 545
	22.4, // 546
	22.4, // 547
	22.5, // 548
	22.5, // 549
	22.5, // 550
	22.6, // 551
	22.6, // 552
	22.6, // 553
	22.7, // 554
	22.7, // 555
	22.7, // 556
	22.8, // 557
	22.8, // 558
	22.8, // 559
	22.9, // 560
	22.9, // 561
	22.9, // 562
	23.0, // 563
	23.0, // 564
	23.0, // 565
	23.1, // 566
	23.1, // 567
	23.1, // 568
	23.2, // 569
	23.2, // 570
	23.2, // 571
	23.3, // 572
	23.3, // 573
	23.3, // 574
	23.4, // 575
	23.4, // 576
	23.4, // 577
	23.5, // 578
	23.5, // 579
	23.5, // 580
	23.6, // 581
	23.6, // 582
	23.6, // 583
	23.7, // 584
	23.7, // 585
	23.7, // 586
	23.8, // 587
	23.8, // 588
	23.8, // 589
	23.9, // 590
	23.9, // 591
	23.9, // 592
	24.0, // 593
	24.0, // 594
	24.0, // 595
	24.1, // 596
	24.1, // 597
	24.1, // 598
	24.2, // 599
	24.2, // 600
	24.2, // 601
	24.3, // 602
	24.3, // 603
	24.3, // 604
	24.4, // 605
	24.4, // 606
	24.4, // 607
	24.5, // 608
	24.5, // 609
	24.5, // 610
	24.6, // 611
	24.6, // 612
	24.6, // 613
	24.6, // 614
	24.7, // 615
	24.7, // 616
	24.7, // 617
	24.8, // 618
	24.8, // 619
	24.8, // 620
	24.9, // 621
	24.9, // 622
	24.9, // 623
	25.0, // 624
	25.0, // 625
	25.0, // 626
	25.1, // 627
	25.1, // 628
	25.1, // 629
	25.2, // 630
	25.2, // 631
	25.2, // 632
	25.3, // 633
	25.3, // 634
	25.3, // 635
	25.4, // 636
	25.4, // 637
	25.4, // 638
	25.5, // 639
	25.5, // 640
	25.5, // 641
	25.6, // 642
	25.6, // 643
	25.6, // 644
	25.7, // 645
	25.7, // 646
	25.7, // 647
	25.8, // 648
	25.8, // 649
	25.8, // 650
	25.9, // 651
	25.9, // 652
	25.9, // 653
	26.0, // 654
	26.0, // 655
	26.0, // 656
	26.1, // 657
	26.1, // 658
	26.2, // 659
	26.2, // 660
	26.2, // 661
	26.3, // 662
	26.3, // 663
	26.4, // 664
	26.4, // 665
	26.4, // 666
	26.5, // 667
	26.5, // 668
	26.6, // 669
	26.6, // 670
	26.6, // 671
	26.7, // 672
	26.7, // 673
	26.8, // 674
	26.8, // 675
	26.8, // 676
	26.9, // 677
	26.9, // 678
	27.0, // 679
	27.0, // 680
	27.1, // 681
	27.1, // 682
	27.2, // 683
	27.2, // 684
	27.3, // 685
	27.3, // 686
	27.3, // 687
	27.4, // 688
	27.4, // 689
	27.5, // 690
	27.5, // 691
	27.6, // 692
	27.6, // 693
	27.7, // 694
	27.7, // 695
	27.8, // 696
	27.9, // 697
	27.9, // 698
	28.0, // 699
	28.0, // 700
	27.8, // 701
	27.9, // 702
	27.9, // 703
	28.0, // 704
	28.0, // 705
	28.1, // 706
	28.1, // 707
	28.2, // 708
	28.2, // 709
	28.3, // 710
	28.3, // 711
	28.4, // 712
	28.5, // 713
	28.5, // 714
	28.6, // 715
	28.6, // 716
	28.7, // 717
	28.8, // 718
	28.8, // 719
	28.9, // 720
	29.0, // 721
	29.0, // 722
	29.1, // 723
	29.1, // 724
	29.2, // 725
	29.3, // 726
	29.3, // 727
	29.4, // 728
	29.5, // 729
	29.5, // 730
	29.6, // 731
	29.7, // 732
	29.8, // 733
	29.8, // 734
	29.9, // 735
	30.0, // 736
	30.1, // 737
	30.1, // 738
	30.2, // 739
	30.3, // 740
	30.4, // 741
	30.4, // 742
	30.5, // 743
	30.6, // 744
	30.7, // 745
	30.8, // 746
	30.8, // 747
	30.9, // 748
	31.0, // 749
	31.1, // 750
	31.2, // 751
	31.3, // 752
	31.3, // 753
	31.4, // 754
	31.5, // 755
	31.6, // 756
	31.7, // 757
	31.8, // 758
	31.9, // 759
	32.0, // 760
	32.1, // 761
	32.2, // 762
	32.3, // 763
	32.4, // 764
	32.5, // 765
	32.6, // 766
	32.7, // 767
	32.8, // 768
	32.9, // 769
	33.0, // 770
	33.1, // 771
	33.2, // 772
	33.3, // 773
	33.4, // 774
	33.5, // 775
	33.6, // 776
	33.8, // 777
	33.9, // 778
	34.0, // 779
	34.1, // 780
	34.2, // 781
	34.3, // 782
	34.5, // 783
	34.6, // 784
	34.7, // 785
	34.8, // 786
	35.0, // 787
	35.1, // 788
	35.2, // 789
	35.4, // 790
	35.5, // 791
	35.6, // 792
	35.8, // 793
	35.9, // 794
	36.0, // 795
	36.2, // 796
	36.3, // 797
	36.5, // 798
	36.6, // 799
	36.7, // 800
	36.9, // 801
	37.0, // 802
	37.2, // 803
	37.3, // 804
	37.5, // 805
	37.7, // 806
	37.8, // 807
	38.0, // 808
	38.1, // 809
	38.3, // 810
	38.5, // 811
	38.6, // 812
	38.8, // 813
	39.0, // 814
	39.1, // 815
	39.3, // 816
	39.5, // 817
	39.7, // 818
	39.8, // 819
	40.0, // 820
	40.2, // 821
	40.4, // 822
	40.6, // 823
	40.7, // 824
	40.9, // 825
	41.1, // 826
	41.3, // 827
	41.5, // 828
	41.7, // 829
	41.9, // 830
	42.1, // 831
	42.3, // 832
	42.5, // 833
	42.7, // 834
	43.0, // 835
	43.2, // 836
	43.4, // 837
	43.6, // 838
	43.8, // 839
	44.0, // 840
	44.3, // 841
	44.5, // 842
	44.7, // 843
	45.0, // 844
	45.2, // 845
	45.4, // 846
	45.7, // 847
	45.9, // 848
	46.1, // 849
	46.4, // 850
	46.6, // 851
	46.9, // 852
	47.1, // 853
	47.4, // 854
	47.7, // 855
	47.9, // 856
	48.2, // 857
	48.4, // 858
	48.7, // 859
	49.0, // 860
	49.3, // 861
	49.5, // 862
	49.8, // 863
	50.1, // 864
	50.4, // 865
	50.7, // 866
	51.0, // 867
	51.3, // 868
	51.6, // 869
	51.9, // 870
	52.2, // 871
	52.5, // 872
	52.8, // 873
	53.1, // 874
	53.4, // 875
	53.7, // 876
	54.0, // 877
	54.4, // 878
	54.7, // 879
	55.0, // 880
	55.4, // 881
	55.7, // 882
	56.0, // 883
	56.4, // 884
	56.7, // 885
	57.1, // 886
	57.4, // 887
	57.8, // 888
	58.1, // 889
	58.5, // 890
	58.9, // 891
	59.2, // 892
	59.6, // 893
	59.8, // 894
	60.1, // 895
	60.3, // 896
	60.6, // 897
	60.8, // 898
	61.1, // 899
	61.4, // 900
	61.8, // 901
	62.2, // 902
	62.7, // 903
	63.1, // 904
	63.6, // 905
	64.0, // 906
	64.5, // 907
	64.9, // 908
	65.4, // 909
	65.8, // 910
	66.3, // 911
	66.7, // 912
	67.1, // 913
	67.6, // 914
	68.0, // 915
	68.5, // 916
	68.9, // 917
	69.4, // 918
	69.8, // 919
	70.3, // 920
	70.7, // 921
	71.2, // 922
	71.6, // 923
	72.0, // 924
	72.5, // 925
	72.9, // 926
	73.4, // 927
	73.8, // 928
	74.3, // 929
	74.7, // 930
	75.2, // 931
	75.6, // 932
	76.1, // 933
	76.5, // 934
	77.0, // 935
	77.4, // 936
	77.8, // 937
	78.3, // 938
	78.7, // 939
	79.2, // 940
	79.6, // 941
	80.1, // 942
	80.5, // 943
	81.0, // 944
	81.4, // 945
	81.9, // 946
	82.3, // 947
	82.7, // 948
	83.2, // 949
	83.6, // 950
	84.1, // 951
	84.5, // 952
	85.0, // 953
	85.4, // 954
	85.9, // 955
	86.3, // 956
	86.8, // 957
	87.2, // 958
	87.6, // 959
	88.2, // 960
	88.7, // 961
	89.2, // 962
	89.7, // 963
	90.3, // 964
	90.8, // 965
	91.3, // 966
	91.8, // 967
	92.4, // 968
	92.9, // 969
	93.4, // 970
	94.1, // 971
	94.8, // 972
	95.5, // 973
	95.7, // 974
	95.9, // 975
	96.4, // 976
	96.7, // 977
	97.0, // 978
	97.3, // 979
	97.7, // 980
	98.1, // 981
	98.5, // 982
	98.7, // 983
	98.8, // 984
	98.9, // 985
	99.0, // 986
	99.2, // 987
	99.3, // 988
	99.4, // 989
	99.8, // 990
	99.8, // 991
	99.8, // 992
	99.8, // 993
	99.8, // 994
	99.8, // 995
	99.8, // 996
	99.8, // 997
	99.8, // 998
	99.8, // 999 
 	99.8  // 1000
}; 
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void Initialize_IR( void );
void IR_Calculation( U16 *pIrBuf, FLAME_HandleTypeDef *flame );
void IR_Detection( U8 index );
void IR_Slope_Calculator( U8 wl, U8 n );

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void Initialize_IR( void )
{
	IrRawIndex = 0;
	
	IrWarCnt = 0;
	IrDetCnt = 0;
	
	if( DeviceType == DTYPE_UVIR ){
		IrLoLmt = epr_sm[EEP_UVIR_IR_VOLT_LMT_L] * 0.001 / ADC_LSB;
		IrHiLmt = epr_sm[EEP_UVIR_IR_VOLT_LMT_H] * 0.001 / ADC_LSB;
		IrSizeLmt = epr_sm[EEP_UVIR_IR_SIZE_LMT];
		IrSizeLmt_NHC = epr_sm[EEP_UVIR_SIZE_LMT_NHC]; //non-hydrocarbon 추가
	}
	else {
		IrLoLmt = epr_sm[EEP_TRIP_IR_VOLT_LMT_L] * 0.001 / ADC_LSB;
		IrHiLmt = epr_sm[EEP_TRIP_IR_VOLT_LMT_H] * 0.001 / ADC_LSB;
		IrSizeLmt = epr_sm[EEP_TRIP_IR_SIZE_LMT];
	}
	
	IrDebTime = epr_sm[EEP_IR_PULSE_WIDTH_LMT];
	IrFlickerCpsRefLmt = epr_sm[EEP_IR_FLICKER_CPS_REF_LMT];
	IrFlickerFactor = ((double)epr_sm[EEP_IR_FLICKER_FACTOR] / 10000 );
	IrNonDetCnt[IR_WL_430] = 0xFF;
	IrNonDetCnt[IR_WL_395] = 0xFF;
	IrNonDetCnt[IR_WL_530] = 0xFF;
	
	IrTimeDvLmtInFreqSame = epr_sm[EEP_IR_TIME_DV_LMT_IN_FREQ_SAME];
	Ir1sAvDvLmtInFreqSame = ((double)epr_sm[EEP_IR_1SAV_DV_LMT_IN_FREQ_SAME] * 0.001 );
	IrSizeDvLmtInFreqSame = epr_sm[EEP_IR_SIZE_DV_LMT_IN_FREQ_SAME];
	
	IrLoSizeLmtCpsRef = epr_sm[EEP_IR_LOW_SIZE_LMT_CPS_REF];
	IrLoSizeLmt = epr_sm[EEP_IR_LOW_SIZE_LMT];
	
	//non-hydrocarbon 추가
	IrSizeLmtOnNonOperFlame = epr_sm[EEP_IR_SIZE_LMT_ON_NON_OPER_FLAME];
	IrLoSizeLmtCpsRef_NHC = epr_sm[EEP_IR_LOW_SIZE_LMT_CPS_REF_NHC];
	IrLoSizeLmt_NHC = epr_sm[EEP_IR_LOW_SIZE_LMT_NHC];
	IrFreqSumLmt = epr_sm[EEP_IR_FREQ_SUM_LMT];
	IrDirCntSumLmt = epr_sm[EEP_IR_DIR_CNT_SUM_LMT];
	IrTimeDvSumLmt = epr_sm[EEP_IR_TIME_DV_SUM_LMT];
	IrTimeDvSumLmtInCntZr = epr_sm[EEP_IR_TIME_DV_SUM_LMT_IN_CNT_ZERO];
	IrFreqAddCntLmt = epr_sm[EEP_IR_FREQ_ADD_CNT_LMT];
	IrDirCntLmtInTimeSame = epr_sm[EEP_IR_DIR_CNT_LMT_IN_TIME_SAME];
	IrSizeLmtInSizeDvPer = epr_sm[EEP_IR_SIZE_LMT_IN_IR_SIZE_DV_PER];
	IrSizeDvPerLmt = ((double)epr_sm[EEP_IR_SIZE_DV_PER_LMT] / 100);
	IrPtoPDvPerLmt = ((double)epr_sm[EEP_IR_PTOP_DV_PER_LMT] / 100);
	IrTimeDvLmtInFreqSame_NHC = epr_sm[EEP_IR_TIME_DV_LMT_IN_FREQ_SAME_NHC];
	//	
		
	Ir1sAvrgDvOverLmt = ((double)epr_sm[EEP_IR_1S_AVRG_DV_OVER_LMT] * 0.001 );
	
	IrBitLmt = ((double)epr_sm[EEP_IR_BIT_THRESHOLD_VOLT] * 0.001 );
	
	IrSizeRocLmt = epr_sm[EEP_IR_ROC_LMT];
	
	IrRelRatioCorrVal_395 = epr_sm[EEP_IR_REL_RATIO_LMT_CORR_VAL] >> 8 & 255;
	IrRelRatioCorrVal_530 = epr_sm[EEP_IR_REL_RATIO_LMT_CORR_VAL] & 255;

	TripModeIrTimeDvLmt = epr_sm[EEP_TRIPMODE_IR_TIME_DV_LMT];
	
	IrSpanBuf[IR_WL_430][0] = ((double)epr_sm[EEP_CAL_BUF_IR430_01] * 0.001);
	IrSpanBuf[IR_WL_430][1] = ((double)epr_sm[EEP_CAL_BUF_IR430_02] * 0.001);
	IrSpanBuf[IR_WL_430][2] = ((double)epr_sm[EEP_CAL_BUF_IR430_03] * 0.001);
	IrSpanBuf[IR_WL_430][3] = ((double)epr_sm[EEP_CAL_BUF_IR430_04] * 0.001);
	IrSpanBuf[IR_WL_430][4] = ((double)epr_sm[EEP_CAL_BUF_IR430_05] * 0.001);
	IrSpanBuf[IR_WL_430][5] = ((double)epr_sm[EEP_CAL_BUF_IR430_06] * 0.001);
	IrSpanBuf[IR_WL_430][6] = ((double)epr_sm[EEP_CAL_BUF_IR430_07] * 0.001);
	
	IrSpanBuf[IR_WL_395][0] = ((double)epr_sm[EEP_CAL_BUF_IR395_01] * 0.001);
	IrSpanBuf[IR_WL_395][1] = ((double)epr_sm[EEP_CAL_BUF_IR395_02] * 0.001);
	IrSpanBuf[IR_WL_395][2] = ((double)epr_sm[EEP_CAL_BUF_IR395_03] * 0.001);
	IrSpanBuf[IR_WL_395][3] = ((double)epr_sm[EEP_CAL_BUF_IR395_04] * 0.001);
	IrSpanBuf[IR_WL_395][4] = ((double)epr_sm[EEP_CAL_BUF_IR395_05] * 0.001);
	IrSpanBuf[IR_WL_395][5] = ((double)epr_sm[EEP_CAL_BUF_IR395_06] * 0.001);
	IrSpanBuf[IR_WL_395][6] = ((double)epr_sm[EEP_CAL_BUF_IR395_07] * 0.001);
	
	IrSpanBuf[IR_WL_530][0] = ((double)epr_sm[EEP_CAL_BUF_IR530_01] * 0.001);
	IrSpanBuf[IR_WL_530][1] = ((double)epr_sm[EEP_CAL_BUF_IR530_02] * 0.001);
	IrSpanBuf[IR_WL_530][2] = ((double)epr_sm[EEP_CAL_BUF_IR530_03] * 0.001);
	IrSpanBuf[IR_WL_530][3] = ((double)epr_sm[EEP_CAL_BUF_IR530_04] * 0.001);
	IrSpanBuf[IR_WL_530][4] = ((double)epr_sm[EEP_CAL_BUF_IR530_05] * 0.001);
	IrSpanBuf[IR_WL_530][5] = ((double)epr_sm[EEP_CAL_BUF_IR530_06] * 0.001);
	IrSpanBuf[IR_WL_530][6] = ((double)epr_sm[EEP_CAL_BUF_IR530_07] * 0.001);
	
	if( DeviceType == DTYPE_UVIR ){
		IrSpanVal[IR_WL_430][0] = epr_sm[EEP_CAL_VAL_IR430_01];
		IrSpanVal[IR_WL_430][1] = epr_sm[EEP_CAL_VAL_IR430_02];
		IrSpanVal[IR_WL_430][2] = epr_sm[EEP_CAL_VAL_IR430_03];
		IrSpanVal[IR_WL_430][3] = epr_sm[EEP_CAL_VAL_IR430_04];
		IrSpanVal[IR_WL_430][4] = epr_sm[EEP_CAL_VAL_IR430_05];
		IrSpanVal[IR_WL_430][5] = epr_sm[EEP_CAL_VAL_IR430_06];
		IrSpanVal[IR_WL_430][6] = epr_sm[EEP_CAL_VAL_IR430_07];
		/*if( FlameType == NON_HYDROCARBON ){
			IrSpanVal[IR_WL_430][0] = epr_sm[EEP_CAL_VAL_IR430_01];
			IrSpanVal[IR_WL_430][1] = epr_sm[EEP_CAL_VAL_IR430_02];
			IrSpanVal[IR_WL_430][2] = epr_sm[EEP_CAL_VAL_IR430_03];
			IrSpanVal[IR_WL_430][3] = epr_sm[EEP_CAL_VAL_IR430_04];
			IrSpanVal[IR_WL_430][4] = epr_sm[EEP_CAL_VAL_IR430_05];
			IrSpanVal[IR_WL_430][5] = epr_sm[EEP_CAL_VAL_IR430_06];
			IrSpanVal[IR_WL_430][6] = epr_sm[EEP_CAL_VAL_IR430_07];
		}
		else{
			IrSpanVal[IR_WL_430][0] = (double)pgm_read_word( &EEP_SYS_DEFAULT[EEP_CAL_VAL_IR430_01] );
			IrSpanVal[IR_WL_430][1] = (double)pgm_read_word( &EEP_SYS_DEFAULT[EEP_CAL_VAL_IR430_02] );
			IrSpanVal[IR_WL_430][2] = (double)pgm_read_word( &EEP_SYS_DEFAULT[EEP_CAL_VAL_IR430_03] );
			IrSpanVal[IR_WL_430][3] = (double)pgm_read_word( &EEP_SYS_DEFAULT[EEP_CAL_VAL_IR430_04] );
			IrSpanVal[IR_WL_430][4] = (double)pgm_read_word( &EEP_SYS_DEFAULT[EEP_CAL_VAL_IR430_05] );
			IrSpanVal[IR_WL_430][5] = (double)pgm_read_word( &EEP_SYS_DEFAULT[EEP_CAL_VAL_IR430_06] );
			IrSpanVal[IR_WL_430][6] = (double)pgm_read_word( &EEP_SYS_DEFAULT[EEP_CAL_VAL_IR430_07] );
		}*/
	}
	else {
		IrSpanVal[IR_WL_430][0] = epr_sm[EEP_CAL_VAL_IR430_01];
		IrSpanVal[IR_WL_430][1] = epr_sm[EEP_CAL_VAL_IR430_02];
		IrSpanVal[IR_WL_430][2] = epr_sm[EEP_CAL_VAL_IR430_03];
		IrSpanVal[IR_WL_430][3] = epr_sm[EEP_CAL_VAL_IR430_04];
		IrSpanVal[IR_WL_430][4] = epr_sm[EEP_CAL_VAL_IR430_05];
		IrSpanVal[IR_WL_430][5] = epr_sm[EEP_CAL_VAL_IR430_06];
		IrSpanVal[IR_WL_430][6] = epr_sm[EEP_CAL_VAL_IR430_07];
		
		IrSpanVal[IR_WL_395][0] = epr_sm[EEP_CAL_VAL_IR395_01];
		IrSpanVal[IR_WL_395][1] = epr_sm[EEP_CAL_VAL_IR395_02];
		IrSpanVal[IR_WL_395][2] = epr_sm[EEP_CAL_VAL_IR395_03];
		IrSpanVal[IR_WL_395][3] = epr_sm[EEP_CAL_VAL_IR395_04];
		IrSpanVal[IR_WL_395][4] = epr_sm[EEP_CAL_VAL_IR395_05];
		IrSpanVal[IR_WL_395][5] = epr_sm[EEP_CAL_VAL_IR395_06];
		IrSpanVal[IR_WL_395][6] = epr_sm[EEP_CAL_VAL_IR395_07];
		
		IrSpanVal[IR_WL_530][0] = epr_sm[EEP_CAL_VAL_IR530_01];
		IrSpanVal[IR_WL_530][1] = epr_sm[EEP_CAL_VAL_IR530_02];
		IrSpanVal[IR_WL_530][2] = epr_sm[EEP_CAL_VAL_IR530_03];
		IrSpanVal[IR_WL_530][3] = epr_sm[EEP_CAL_VAL_IR530_04];
		IrSpanVal[IR_WL_530][4] = epr_sm[EEP_CAL_VAL_IR530_05];
		IrSpanVal[IR_WL_530][5] = epr_sm[EEP_CAL_VAL_IR530_06];
		IrSpanVal[IR_WL_530][6] = epr_sm[EEP_CAL_VAL_IR530_07];
	}
	
	IR_Slope_Calculator( IR_WL_430, 0 );
	IR_Slope_Calculator( IR_WL_430, 1 );
	IR_Slope_Calculator( IR_WL_430, 2 );
	IR_Slope_Calculator( IR_WL_430, 3 );
	IR_Slope_Calculator( IR_WL_430, 4 );
	IR_Slope_Calculator( IR_WL_430, 5 );
	IR_Slope_Calculator( IR_WL_430, 6 );
	
	IR_Slope_Calculator( IR_WL_395, 0 );
	IR_Slope_Calculator( IR_WL_395, 1 );
	IR_Slope_Calculator( IR_WL_395, 2 );
	IR_Slope_Calculator( IR_WL_395, 3 );
	IR_Slope_Calculator( IR_WL_395, 4 );
	IR_Slope_Calculator( IR_WL_395, 5 );
	IR_Slope_Calculator( IR_WL_395, 6 );
	
	IR_Slope_Calculator( IR_WL_530, 0 );
	IR_Slope_Calculator( IR_WL_530, 1 );
	IR_Slope_Calculator( IR_WL_530, 2 );
	IR_Slope_Calculator( IR_WL_530, 3 );
	IR_Slope_Calculator( IR_WL_530, 4 );
	IR_Slope_Calculator( IR_WL_530, 5 );
	IR_Slope_Calculator( IR_WL_530, 6 );
	
	DPRINT( " [ IR ]\n" );
	DPRINT3( "\n NOISE: %.3f[V], %.3f[V], %u[MSEC]", (double)(IrLoLmt * ADC_LSB), (double)(IrHiLmt * ADC_LSB), IrDebTime*4 );
	DPRINT1( "\n BIT: %.3f[V]", IrBitLmt );
	DPRINT1( "\n SIZE: %2u", IrSizeLmt );
	
	if( DeviceType == DTYPE_UVIR ){
		DPRINT1( "\n FREQ SAME: %u[MSEC]", IrTimeDvLmtInFreqSame*4 );
		DPRINT2( "\n FLK: %u[CPS], %.6f", IrFlickerCpsRefLmt, IrFlickerFactor );
		DPRINT1( "\n 1S AVER DEV: %.3f[V]", Ir1sAvrgDvOverLmt );
		DPRINT2( "\n LO SIZE: %u[CPS], %u", IrLoSizeLmtCpsRef, IrLoSizeLmt );
		DPRINT1( "\n RESPONSIVITY: %u", epr_sm[EEP_CAL_BUF_IR430_RESPONSIVITY] );
	}
	else {
		DPRINT1( "\n R.R.RATIO COR 395: %d", IrRelRatioCorrVal_395 );
		DPRINT1( "\n R.R.RATIO COR 530: %d", IrRelRatioCorrVal_530 );
		DPRINT1( "\n SIZE ROC: %u", IrSizeRocLmt );
		DPRINT3( "\n FREQ SAME: %u[MSEC], %.3f[V], %u", IrTimeDvLmtInFreqSame*4, Ir1sAvDvLmtInFreqSame, IrSizeDvLmtInFreqSame );
		DPRINT1( "\n TD: %u", TripModeIrTimeDvLmt );
	}

	IrAvPtoPMax = 0;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void IR_Calculation( U16 *pIrBuf, FLAME_HandleTypeDef *flame )
{
	FLAME_HandleTypeDef		*fp;
	double					fBuf;
	S16						FreqDv, TimeDv;
	U16						i, PulseWidth, IrBuf; //, iPeak;
	U8						Status;
	U16						wi, wc, LoCnt, HiCnt, wSize[3];
	double					min, max;
	//U16						LoPeakPrv, LoPeakCur, LoPeakDv, LoPeakDvSum;
	//U16						HiPeakPrv, HiPeakCur, HiPeakDv, HiPeakDvSum;
	U16						IrBufPrv, IrSizeDv;
	U8						DirStatus, DirUpCnt, DirDwCnt;
	U16						LoDirChangeCnt, HiDirChangeCnt;
	U16						LoTimePeak, HiTimePeak;
	U16						LoTimePrv, LoTimeDv, LoTimeDvSum;
	U16						HiTimePrv, HiTimeDv, HiTimeDvSum;
		
	if (DeviceType == DTYPE_TRIPLE)
		wc = 3;
	else {
		wc = 1;
		flame->IrLmtOffset[IR_WL_430] = pgm_read_byte( &IrLmtOffset_430[TempDv] );
	}
	
	for( wi=0; wi<wc; wi++, pIrBuf+=IR_BUF_SIZE )
	{
		PulseWidth = 1;
		
		if (flame == &Flame[0])		fp = &Flame[FLAME_BUFF_SIZE-1];
		else						fp = flame-1;
			
		Status = SPECTRUM_POSI_C;
		
		flame->Ir1sAvrg[wi] = 0;
		
		flame->IrLoFreq[wi] = 0;
		flame->IrLoTime[wi] = 0;
		flame->IrLoPeak[wi] = 1023;
		flame->IrLoAvrg[wi] = 0;
		
		flame->IrHiFreq[wi] = 0;
		flame->IrHiTime[wi] = 0;
		flame->IrHiPeak[wi] = 0;
		flame->IrHiAvrg[wi] = 0;
		
		LoCnt	= 0;
		HiCnt	= 0;
		
		if(FlameType == NON_HYDROCARBON)
		{
			//flame->IrAverDvSum[wi] = 0;
			flame->IrTimeDvSum[wi] = 0;
			//flame->IrPeakDvSum[wi] = 0;
			
			IrBufPrv = 0;
			DirStatus = IR_DIR_INIT;
			DirUpCnt = 0;
			DirDwCnt = 0;
			LoDirChangeCnt = 0;
			HiDirChangeCnt = 0;
			
			//iPeak	= 0;
			//LoPeakPrv	= 512;
			//LoPeakCur	= 512;
			//LoPeakDv	= 0;
			//LoPeakDvSum = 0;
			LoTimePeak	= 0;
			LoTimePrv	= 0;
			LoTimeDv	= 0;
			LoTimeDvSum	= 0;
			
			//HiPeakPrv	= 512;
			//HiPeakCur	= 512;
			//HiPeakDv	= 0;
			//HiPeakDvSum = 0;
			HiTimePeak	= 0;
			HiTimePrv	= 0;
			HiTimeDv	= 0;
			HiTimeDvSum = 0;
		}
		
		for (i = 0; i < IR_BUF_SIZE; i++)
		{
			IrBuf = *(pIrBuf+i);
			switch( Status )
			{
				case SPECTRUM_POSI_C:
					PulseWidth = 1;
					
					if (IrBuf < (IrLoLmt + flame->IrLmtOffset[IR_WL_430]))		Status = SPECTRUM_POSI_L;
					else if (IrBuf > (IrHiLmt + flame->IrLmtOffset[IR_WL_430]))	Status = SPECTRUM_POSI_H;
					break;
					
				case SPECTRUM_POSI_L:
					if (FlameType == NON_HYDROCARBON) 
					{
						if (( IrBuf >= (IrLoLmt + flame->IrLmtOffset[IR_WL_430]) ) || ( i == ( IR_BUF_SIZE-1 )))   // Lo 펄스 끝나는 조건
						{
							if ((i == ( IR_BUF_SIZE-1 )) && ( IrBuf < (IrLoLmt + flame->IrLmtOffset[IR_WL_430])))
								PulseWidth++;
							else	// 펄스에 대한 통계
							{
								if (( PulseWidth > IrDebTime ) && ( i > PulseWidth))
								{
									flame->IrLoFreq[wi] += 1;			// Lo 펄스
									flame->IrLoTime[wi] += PulseWidth;	// Lo 펄스 샘플수
							
									if (LoTimePrv > 0) {
										LoTimeDv = abs(LoTimePrv - PulseWidth);
										LoTimeDvSum += LoTimeDv;
									}
									LoTimePrv = PulseWidth;
									if (LoTimePeak < PulseWidth)
										LoTimePeak = PulseWidth;
								}
							}
														
							if( IrBuf > (IrHiLmt + flame->IrLmtOffset[IR_WL_430]) ){
								Status = SPECTRUM_POSI_H;
								PulseWidth = 1; // 2018-03-29 ���� 1:32:28
							}
							else	Status = SPECTRUM_POSI_C;
							
							DirUpCnt = 0;
							DirDwCnt = 0;
							DirStatus = IR_DIR_INIT;
						}
						else	// Lo 에서 계속 내려가는 구간
						{
							PulseWidth++;
							if (abs(IrBufPrv - IrBuf) > IR_DIR_DET_LMT)
							{
								if (IrBufPrv < IrBuf)
								{
									DirDwCnt = 0;
									DirUpCnt++;
									if (DirUpCnt > IR_DIR_CNT_LMT)
										DirStatus = IR_DIR_UP;
								}
								else
								{
									DirUpCnt = 0;
									DirDwCnt++;
									if (DirDwCnt > IR_DIR_CNT_LMT) 
									{
										if (DirStatus == IR_DIR_UP)
											LoDirChangeCnt++;
										DirStatus = IR_DIR_DOWN;
									}
								}
							}
						}
					}
					else  // HYDROCARBON
					{
						if (( IrBuf >= (IrLoLmt + flame->IrLmtOffset[IR_WL_430]) ) || ( i == ( IR_BUF_SIZE-1 )))
						{
							if (i == ( IR_BUF_SIZE-1))
								PulseWidth++;
							
							if (PulseWidth > IrDebTime) {
								flame->IrLoFreq[wi] += 1;
								flame->IrLoTime[wi] += PulseWidth;
							}
							
							if (IrBuf > (IrHiLmt + flame->IrLmtOffset[IR_WL_430])) {
								Status = SPECTRUM_POSI_H;
								PulseWidth = 1; // 2018-03-29 ���� 1:32:28
							}
							else	Status = SPECTRUM_POSI_C;
						}
						else	// Lo 에서 계속 내려가는 구간
						{
							PulseWidth++;
						}
					}
					break;
					
				case SPECTRUM_POSI_H:
					if (FlameType == NON_HYDROCARBON) 
					{
						if (( IrBuf <= (IrHiLmt + flame->IrLmtOffset[IR_WL_430]) ) || ( i == ( IR_BUF_SIZE-1 )))	// Hi 펄스 끝나는 조건
						{
							if ((i == ( IR_BUF_SIZE-1 )) && (IrBuf > (IrHiLmt + flame->IrLmtOffset[IR_WL_430]))) 
								PulseWidth++;
							else  // 펄스에 대한 통계
							{
								if (( PulseWidth > IrDebTime ) && ( i > PulseWidth))
								{
									flame->IrHiFreq[wi] += 1;				// Hi 펄스
									flame->IrHiTime[wi] += PulseWidth;      // Hi 펄스 샘플수

									if (HiTimePrv > 0) {
										HiTimeDv = abs(HiTimePrv - PulseWidth);
										HiTimeDvSum += HiTimeDv;
									}
									HiTimePrv = PulseWidth;
									if (HiTimePeak < PulseWidth)
										HiTimePeak = PulseWidth;
								}
							}
														
							if (IrBuf < (IrLoLmt + flame->IrLmtOffset[IR_WL_430])) {
								Status = SPECTRUM_POSI_L;
								PulseWidth = 1; // 2018-03-29 ���� 1:32:28
							}
							else	Status = SPECTRUM_POSI_C;
							
							DirUpCnt = 0;
							DirDwCnt = 0;
							DirStatus = IR_DIR_INIT;
						}
						else    // Hi 에서 올라가는 구간
						{
							PulseWidth++;
							if (abs(IrBufPrv - IrBuf) > IR_DIR_DET_LMT) 
							{
								if (IrBufPrv < IrBuf) {
									DirDwCnt = 0;
									DirUpCnt++;
									if (DirUpCnt > IR_DIR_CNT_LMT) {
										if (DirStatus == IR_DIR_DOWN) 
											HiDirChangeCnt++;
										DirStatus = IR_DIR_UP;
									}
								}
								else
								{
									DirUpCnt = 0;
									DirDwCnt++;
									if (DirDwCnt > IR_DIR_CNT_LMT)
										DirStatus = IR_DIR_DOWN;
								}
							}
						}
					}
					else	// HYDROCARBON
					{
						if (( IrBuf <= (IrHiLmt + flame->IrLmtOffset[IR_WL_430]) ) || ( i == ( IR_BUF_SIZE-1 )))
						{
							if (i == ( IR_BUF_SIZE-1))
								PulseWidth++;
							
							if (PulseWidth > IrDebTime) {
								flame->IrHiFreq[wi] += 1;
								flame->IrHiTime[wi] += PulseWidth;
							}
							
							if (IrBuf < (IrLoLmt + flame->IrLmtOffset[IR_WL_430])) {
								Status = SPECTRUM_POSI_L;
								PulseWidth = 1; // 2018-03-29 ���� 1:32:28
							}
							else	Status = SPECTRUM_POSI_C;
						}
						else 
						{
							PulseWidth++;
						}
					}
					break;
			} // end switch
			
			if (IrBuf < flame->IrLoPeak[wi])		flame->IrLoPeak[wi] = IrBuf;
			else if (IrBuf > flame->IrHiPeak[wi])	flame->IrHiPeak[wi] = IrBuf;
			
			if (IrBuf < 512) {
				LoCnt++;
				flame->IrLoAvrg[wi] += IrBuf;
			}
			else {
				HiCnt++;
				flame->IrHiAvrg[wi] += IrBuf;
			}
			
			flame->Ir1sAvrg[wi] += IrBuf;
			
			IrBufPrv = IrBuf;
		} // end for
		
		if (flame->IrLoFreq[wi] > 0) {
			//LoPeakDvSum = LoPeakDvSum / flame->IrLoFreq[wi];
			LoTimeDvSum = LoTimeDvSum / flame->IrLoFreq[wi];
		}
		
		if (flame->IrHiFreq[wi] > 0) {
			//HiPeakDvSum = HiPeakDvSum / flame->IrHiFreq[wi];
			HiTimeDvSum = HiTimeDvSum / flame->IrHiFreq[wi];
		}
		
		flame->IrTimeDvSum[wi] = LoTimeDvSum + HiTimeDvSum;		// 전체 IR 주기 변동성
		
		flame->IrWidestTimeSum[wi] = LoTimePeak + HiTimePeak;
		//flame->IrPeakDvSum[wi] = ( ((double)LoPeakDvSum + (double)HiPeakDvSum) ) * ADC_LSB ;
		
		flame->IrDirCntSum[wi] = HiDirChangeCnt + LoDirChangeCnt;	// IR 방향전환 횟수 (깜빡임)
		flame->IrFreqDirCntSum[wi] = flame->IrHiFreq[wi] + flame->IrLoFreq[wi] + flame->IrDirCntSum[wi];
						
		flame->IrLoPeak[wi] *= ADC_LSB;
		if (LoCnt)	flame->IrLoAvrg[wi] = flame->IrLoAvrg[wi] / LoCnt * ADC_LSB;
		else		flame->IrLoAvrg[wi] = flame->IrLoPeak[wi];
		
		flame->IrHiPeak[wi] *= ADC_LSB;
		if (HiCnt)	flame->IrHiAvrg[wi] = flame->IrHiAvrg[wi] / HiCnt * ADC_LSB;
		else		flame->IrHiAvrg[wi] = flame->IrHiPeak[wi];
		
		flame->Ir1sAvrg[wi] = flame->Ir1sAvrg[wi] / IR_BUF_SIZE * ADC_LSB;
		
		fBuf = flame->Ir1sAvrg[wi] - fp->Ir1sAvrg[wi];
		flame->Ir1sAvrgDv[wi] = fabs( fBuf );
				
		flame->Ir1sPtoP[wi] = flame->IrHiPeak[wi] - flame->IrLoPeak[wi];
		flame->IrAvPtoP[wi] = flame->IrHiAvrg[wi] - flame->IrLoAvrg[wi];
		
		if (flame->Ir1sPtoP[wi] == 0) {
			flame->IrAvPtoP[wi] = 5;
			flame->IrPtoPDvPer[wi] = 0;
		}
		else	flame->IrPtoPDvPer[wi] = ( fabs( fp->Ir1sPtoP[wi] - flame->Ir1sPtoP[wi] ) ) / flame->Ir1sPtoP[wi];
		
		/* ***********************************************************************************
			IrSpanBuf : Calibration parameter [V]
			IrAvPtoP  : 현재 [V] 값, 변수
			IrSpanVal : 구간별 기준값 (IR Size)
			IrSize    : 구하려는 IR Size -> 구간별 기울기와 구하려는 지점 기울기는 같다..
		*********************************************************************************** */	
		if( flame->IrAvPtoP[wi] > IrSpanBuf[wi][5] ){
			flame->IrSize[wi] = (U16)( IrSpanVal[wi][5] + ( flame->IrAvPtoP[wi] - IrSpanBuf[wi][5] ) / IrSlope[wi][6] );
		}
		else if( flame->IrAvPtoP[wi] > IrSpanBuf[wi][4] ){
			flame->IrSize[wi] = (U16)( IrSpanVal[wi][4] + ( flame->IrAvPtoP[wi] - IrSpanBuf[wi][4] ) / IrSlope[wi][5] );
		}
		else if( flame->IrAvPtoP[wi] > IrSpanBuf[wi][3] ){
			flame->IrSize[wi] = (U16)( IrSpanVal[wi][3] + ( flame->IrAvPtoP[wi] - IrSpanBuf[wi][3] ) / IrSlope[wi][4] );
		}
		else if( flame->IrAvPtoP[wi] > IrSpanBuf[wi][2] ){
			flame->IrSize[wi] = (U16)( IrSpanVal[wi][2] + ( flame->IrAvPtoP[wi] - IrSpanBuf[wi][2] ) / IrSlope[wi][3] );
		}
		else if( flame->IrAvPtoP[wi] > IrSpanBuf[wi][1] ){
			flame->IrSize[wi] = (U16)( IrSpanVal[wi][1] + ( flame->IrAvPtoP[wi] - IrSpanBuf[wi][1] ) / IrSlope[wi][2] );
		}
		else if( flame->IrAvPtoP[wi] > IrSpanBuf[wi][0] ){
			flame->IrSize[wi] = (U16)( IrSpanVal[wi][0] + ( flame->IrAvPtoP[wi] - IrSpanBuf[wi][0] ) / IrSlope[wi][1] );
		}
		else {	// flame->IrAvPtoP[wi] < IrSpanBuf[wi][0]
			flame->IrSize[wi] = (U16)( flame->IrAvPtoP[wi] / IrSlope[wi][0] );
		}
	

		if (flame->IrSize[wi] > 1000)	wSize[wi] = 1000;
		else							wSize[wi] = flame->IrSize[wi];
		
		if( flame->IrSize[wi] > fp->IrSize[wi] ){
			min = fp->IrSize[wi];
			max = flame->IrSize[wi];
		}
		else {
			min = flame->IrSize[wi];
			max = fp->IrSize[wi];
		}
		
		if( min == 0 ){
			flame->IrSizeRoc[wi] = 0;
		}
		else {
			flame->IrSizeRoc[wi] = (U16)(fabs(( min - max ) / min * 100 ));
			if( flame->IrSizeRoc[wi] > 999 ){
				flame->IrSizeRoc[wi] = 999;
			}
		}
		
		if( flame->IrSize[wi] == 0) flame->IrSizeDvPer[wi] = 0;
		else {
			IrSizeDv = abs(fp->IrSize[wi] - flame->IrSize[wi]);
			flame->IrSizeDvPer[wi] = ( (double)((double)IrSizeDv / (double)flame->IrSize[wi]) ) ;
		}
		
		if( wi == IR_WL_430 ){
			if( BIT_Status == BIT_STATE_IDLE ){
				if( flame->IrAvPtoP[IR_WL_430] > IrAvPtoPMax ){
					IrAvPtoPMax = flame->IrAvPtoP[IR_WL_430];
				}
			}
		}
		
		fBuf = flame->IrAvPtoP[wi] - fp->IrAvPtoP[wi];
		flame->IrAvPtoPDv[wi] = fabs( fBuf );
		
		FreqDv = (S16)flame->IrHiFreq[wi] - (S16)flame->IrLoFreq[wi];
		TimeDv = (S16)flame->IrHiTime[wi] - (S16)flame->IrLoTime[wi];
		
		flame->IrFreqDv[wi] = abs( FreqDv );
		flame->IrTimeDv[wi] = abs( TimeDv );
		
		if( !flame->IrLoFreq[wi] && !flame->IrHiFreq[wi] ){
			if( IrNonDetCnt[wi] != 0xFF ){
				IrNonDetCnt[wi]++;
			}
		}
		else {
			if(( IrNonDetCnt[wi] >= IR_FSO_TIME ) || ( BIT_Status != BIT_STATE_IDLE )){
				flame->IrLoFreq[wi] = 0;
				flame->IrHiFreq[wi] = 0;
			}
			if( BIT_Status == BIT_STATE_IDLE ){
				IrNonDetCnt[wi] = 0;
			}
		}
	}

// **************************************************************************************************************
	//flame->IrRatioLmt[IR_WL_395] = pgm_read_float( &IR_Rel_Ratio_Limit_395[wSize[IR_WL_430]] );
	//flame->IrRatioLmt[IR_WL_530] = pgm_read_float( &IR_Rel_Ratio_Limit_530[wSize[IR_WL_430]] );
	//printf(" f %f \r\n", flame->IrRatioLmt[IR_WL_395]);
	//printf(" SZ: %d, Lmt395: %.1f, Lmt530: %.1f  \r\n", wSize[IR_WL_430], flame->IrRatioLmt[IR_WL_395], flame->IrRatioLmt[IR_WL_530]);	
	
	//flame->IrRatioLmt[IR_WL_395] = EEP_Rd(TRIPLE_IR_REL_RATIO_395_SIZE_1) / 10.0f;
	//printf(" e %f \r\n", flame->IrRatioLmt[IR_WL_395]);
	
	// jmyoo
	if (wSize[IR_WL_430] == 0 || wSize[IR_WL_430] == 1) {
		flame->IrRatioLmt[IR_WL_395] = EEP_Rd(TRIPLE_IR_REL_RATIO_395_SIZE_1) / 10.0f;
		flame->IrRatioLmt[IR_WL_530] = EEP_Rd(TRIPLE_IR_REL_RATIO_530_SIZE_1) / 10.0f;
		
	} else if (wSize[IR_WL_430] % 2 == 1) {	// odd
		flame->IrRatioLmt[IR_WL_395] = EEP_Rd( TRIPLE_IR_REL_RATIO_395_SIZE_1 + (wSize[IR_WL_430]-1)/2 ) / 10.0f;
		flame->IrRatioLmt[IR_WL_530] = EEP_Rd( TRIPLE_IR_REL_RATIO_530_SIZE_1 + (wSize[IR_WL_430]-1)/2 ) / 10.0f;
		
	} else if (wSize[IR_WL_430] % 2 == 0) {	// even
		flame->IrRatioLmt[IR_WL_395] = EEP_Rd( TRIPLE_IR_REL_RATIO_395_SIZE_1 + (wSize[IR_WL_430]/2 -1) ) / 10.0f;
		flame->IrRatioLmt[IR_WL_530] = EEP_Rd( TRIPLE_IR_REL_RATIO_530_SIZE_1 + (wSize[IR_WL_430]/2 -1) ) / 10.0f;
	}
	
	//printf(" Algo~  Lmt395: %.1f, Lmt530: %.1f  \r\n", flame->IrRatioLmt[IR_WL_395], flame->IrRatioLmt[IR_WL_530]);	
// **************************************************************************************************************	
	if(wSize[IR_WL_430] <= IR_395_OFFSET_LMT){
		flame->IrRatioLmt[IR_WL_395] += IrRelRatioCorrVal_395;     
		//flame->IrRatioLmt[IR_WL_395] += (float)IrRelRatioCorrVal_395/10;      
	}  
	if(flame->IrRatioLmt[IR_WL_395] >= 99.8) {
		flame->IrRatioLmt[IR_WL_395] = 99.8;
	}
	if(wSize[IR_WL_430] <= IR_530_OFFSET_LMT){
		flame->IrRatioLmt[IR_WL_530] += IrRelRatioCorrVal_530;   
		//flame->IrRatioLmt[IR_WL_530] += (float)IrRelRatioCorrVal_530/10;
	}  
	if(flame->IrRatioLmt[IR_WL_530] >= 99.8) {
		flame->IrRatioLmt[IR_WL_530] = 99.8;
	}
	
	flame->IrRelRatio[IR_WL_395] = (double)wSize[IR_WL_395] / (double)wSize[IR_WL_430] * 100;
	flame->IrRelRatio[IR_WL_530] = (double)wSize[IR_WL_530] / (double)wSize[IR_WL_430] * 100;
	
	if( DeviceType == DTYPE_UVIR )
	{
		switch( IrNonDetCnt[IR_WL_430] )
		{
			case 0:
				if(( BIT_Status == BIT_STATE_IDLE ) && ( AlarmState != ALARM_STATE_FLAME )){
					SMPS_ON();
				}
				break;
				
			case UV_POWER_RET_TIME:
				if( BIT_Status == BIT_STATE_IDLE ){
					if( UvPwrCtrlFlag ){
						SMPS_OFF();
					}
				}
				else {
					IrNonDetCnt[IR_WL_430]--;
				}
				break;
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void IR_Detection( U8 index )
{
	double	Fref[3];
	double	Ir1sAvDvLmt;
	U16		i, iPrev;
	U16		LoTimeDv, HiTimeDv, IrFreqSum, IrWidestTimeSumDv;
	U16		SizeDv;
	U8		bFlag = 0, Cnt;
	U16		Cps[3];
	
	if( index == 0 ){
		iPrev = FLAME_BUFF_SIZE-1;
	}
	else {
		iPrev = index-1;
	}
	
	if(FlameType == NON_HYDROCARBON)
	{
		IrFreqSum = Flame[index].IrLoFreq[IR_WL_430] + Flame[index].IrHiFreq[IR_WL_430];
		
		if( (( IrFreqSum < IrFreqSumLmt ) &&  ( Flame[iPrev].IrDirCntSum == 0 ) && ( Flame[index].IrDirCntSum == 0 )) ||
			(( Flame[index].IrLoFreq[IR_WL_430] == 0 ) &&  ( Flame[iPrev].IrDirCntSum[IR_WL_430] == 0 ) && ( Flame[index].IrDirCntSum[IR_WL_430] == 0 )) ||
			(( Flame[index].IrHiFreq[IR_WL_430] == 0 ) &&  ( Flame[iPrev].IrDirCntSum[IR_WL_430] == 0 ) && ( Flame[index].IrDirCntSum[IR_WL_430] == 0 )) ){
			bFlag |= 0x80;
		}
		
		if( Flame[index].UvCpsItg > UvDetLmtOnIrSizeLmtChange ) {
			if( Flame[index].IrSize[IR_WL_430] < IrSizeLmt_NHC ){
				bFlag |= 0x40;
			}	
		}
		else {
			if( Flame[index].IrSize[IR_WL_430] < IrSizeLmtOnNonOperFlame ){
				bFlag |= 0x40;
			}
		}
	}
	else 
	{
		if(( Flame[index].IrLoFreq[IR_WL_430] == 0 ) && ( Flame[index].IrHiFreq[IR_WL_430] == 0 )){
			bFlag |= 0x80;
		}
		if( Flame[index].IrSize[IR_WL_430] < IrSizeLmt ){
			bFlag |= 0x40;
		}
	}
	
	if( DeviceType == DTYPE_UVIR )
	{
		LoTimeDv = abs((S16)Flame[index].IrLoTime[IR_WL_430] - (S16)Flame[iPrev].IrLoTime[IR_WL_430]);
		HiTimeDv = abs((S16)Flame[index].IrHiTime[IR_WL_430] - (S16)Flame[iPrev].IrHiTime[IR_WL_430]);
		
		if(FlameType == NON_HYDROCARBON){
			IrWidestTimeSumDv = abs((S16)Flame[index].IrWidestTimeSum[IR_WL_430] - (S16)Flame[iPrev].IrWidestTimeSum[IR_WL_430]);
			
			if( ( Flame[index].IrLoTime[IR_WL_430] == Flame[iPrev].IrLoTime[IR_WL_430] ) &&
				( Flame[index].IrHiTime[IR_WL_430] == Flame[iPrev].IrHiTime[IR_WL_430] ) &&
				( LoTimeDv < IrTimeDvLmtInFreqSame_NHC) && ( HiTimeDv < IrTimeDvLmtInFreqSame_NHC) && 
				( Flame[iPrev].IrDirCntSum[IR_WL_430] < IrDirCntSumLmt ) && 
				( Flame[index].IrDirCntSum[IR_WL_430] < IrDirCntSumLmt ) ){
				bFlag |= 0x20;
			}
			
			if( ( IrWidestTimeSumDv < IrTimeDvSumLmt ) && ( Flame[index].IrTimeDvSum[IR_WL_430] < IrTimeDvSumLmt ) &&
				( Flame[iPrev].IrDirCntSum[IR_WL_430] == 0 ) && ( Flame[index].IrDirCntSum[IR_WL_430] == 0 ) ){
				bFlag |= 0x10;
			}
			
			if( ( Flame[index].IrSizeDvPer[IR_WL_430] < IrSizeDvPerLmt ) && ( Flame[index].UvCpsRaw < UvCpsLmtInIrSizeDvPer ) &&
				( ( Flame[index].IrLoFreq[IR_WL_430] == 0 ) || ( Flame[index].IrHiFreq[IR_WL_430] == 0 ) ) ){
				bFlag |= 0x08;
			}
			
			if( ( Flame[iPrev].IrDirCntSum[IR_WL_430] == 0 ) && ( Flame[index].IrDirCntSum[IR_WL_430] == 0 ) &&
				( Flame[index].IrTimeDvSum[IR_WL_430] < IrTimeDvSumLmtInCntZr ) ){
				bFlag |= 0x04;	
			}
			
			if( ( Flame[index].IrSizeDvPer[IR_WL_430] < IrSizeDvPerLmt ) && 
				( Flame[iPrev].IrSizeDvPer[IR_WL_430] < IrSizeDvPerLmt ) &&
				( Flame[index].IrPtoPDvPer[IR_WL_430] < IrPtoPDvPerLmt ) &&
				( Flame[iPrev].IrPtoPDvPer[IR_WL_430] < IrPtoPDvPerLmt ) && 
				( Flame[index].Ir1sPtoP[IR_WL_430] < IR_PtoP_SATURATION ) ){
				bFlag |= 0x02;	
			}
			
		}
		else{
			if( ( Flame[index].IrLoFreq[IR_WL_430] == Flame[iPrev].IrLoFreq[IR_WL_430] ) && ( LoTimeDv < IrTimeDvLmtInFreqSame ) &&
			( Flame[index].IrHiFreq[IR_WL_430] == Flame[iPrev].IrHiFreq[IR_WL_430] ) && ( HiTimeDv < IrTimeDvLmtInFreqSame )){
				bFlag |= 0x20;
			}
			
			Cps[index] = Flame[index].UvCpsRes;
			Cps[iPrev] = Flame[iPrev].UvCpsRes;
			if( Cps[index] > IrFlickerCpsRefLmt ){
				Cps[index] = IrFlickerCpsRefLmt;
			}
			if( Cps[iPrev] > IrFlickerCpsRefLmt ){
				Cps[iPrev] = IrFlickerCpsRefLmt;
			}
			Fref[index] = Cps[index] * IrFlickerFactor;
			Fref[iPrev] = Cps[iPrev] * IrFlickerFactor;
			
			if(( Flame[index].Ir1sAvrgDv[IR_WL_430] < Fref[index] ) && ( Flame[iPrev].Ir1sAvrgDv[IR_WL_430] < Fref[iPrev] )){
				bFlag |= 0x10;
			}
			if(( Flame[index].IrAvPtoPDv[IR_WL_430] < Fref[index] ) && ( Flame[iPrev].IrAvPtoPDv[IR_WL_430] < Fref[iPrev] )){
				bFlag |= 0x08;
			}
			
			if( Flame[index].Ir1sAvrgDv[IR_WL_430] > Ir1sAvrgDvOverLmt ){
				bFlag |= 0x04;
			}
			
			if( Flame[index].UvCpsRaw > IrLoSizeLmtCpsRef ){
				if( Flame[index].IrSize[IR_WL_430] < IrLoSizeLmt ){
					bFlag |= 0x02;
				}
			}
		}
	}
	else 
	{
		if(( Flame[iPrev].IrRelRatio[IR_WL_395] > Flame[iPrev].IrRatioLmt[IR_WL_395] ) || ( Flame[index].IrRelRatio[IR_WL_395] > Flame[index].IrRatioLmt[IR_WL_395] )){
			bFlag |= 0x20;
		}
		
		if(( Flame[iPrev].IrRelRatio[IR_WL_530] > Flame[iPrev].IrRatioLmt[IR_WL_530] ) || ( Flame[index].IrRelRatio[IR_WL_530] > Flame[index].IrRatioLmt[IR_WL_530] )){
			bFlag |= 0x10;
		}
		
		if(( Flame[index].IrSizeRoc[IR_WL_430] > IrSizeRocLmt ) || ( Flame[index].IrSizeRoc[IR_WL_395] > IrSizeRocLmt ) || ( Flame[index].IrSizeRoc[IR_WL_530] > IrSizeRocLmt )){
			bFlag |= 0x08;
		}
		
		LoTimeDv = abs((S16)Flame[index].IrLoTime[IR_WL_430] - (S16)Flame[iPrev].IrLoTime[IR_WL_430]);
		HiTimeDv = abs((S16)Flame[index].IrHiTime[IR_WL_430] - (S16)Flame[iPrev].IrHiTime[IR_WL_430]);
		SizeDv = abs((S16)Flame[index].IrSize[IR_WL_430] - (S16)Flame[iPrev].IrSize[IR_WL_430]);

		if(Flame[index].IrSize[IR_WL_430] > 900 && Flame[iPrev].IrSize[IR_WL_430] > 900){
			Ir1sAvDvLmt = Ir1sAvDvLmtInFreqSame * 5;
		}
		else{
			Ir1sAvDvLmt = Ir1sAvDvLmtInFreqSame;
		}

		if( ( Flame[index].IrLoFreq[IR_WL_430] == Flame[iPrev].IrLoFreq[IR_WL_430] ) && ( LoTimeDv < IrTimeDvLmtInFreqSame ) &&
			( Flame[index].IrHiFreq[IR_WL_430] == Flame[iPrev].IrHiFreq[IR_WL_430] ) && ( HiTimeDv < IrTimeDvLmtInFreqSame ) &&
			( Flame[index].Ir1sAvrgDv[IR_WL_430] < Ir1sAvDvLmt ) && ( Flame[iPrev].Ir1sAvrgDv[IR_WL_430] < Ir1sAvDvLmt ) &&
			( SizeDv < IrSizeDvLmtInFreqSame )){
			bFlag |= 0x04;
		}
		
		if( Flame[index].IrTimeDv[IR_WL_430] > TripModeIrTimeDvLmt ){
			bFlag |= 0x02;
		}
	}
	
	if( mmi_mode == FMODE_WARM_UP ){
		Flame[index].IrFtFlag = 0xFF;
	}
	else {
		Flame[index].IrFtFlag = bFlag;
	}
	
	for( i=0, Cnt=0; i<3; i++ ){
		if( Flame[i].IrFtFlag == 0 ){
			Cnt++;
		}
	}
	
	Flame[index].IrCnt = Cnt;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void IR_Slope_Calculator( U8 wl, U8 n )
{
	if (n)	IrSlope[wl][n] = ( IrSpanBuf[wl][n] - IrSpanBuf[wl][n-1] ) / ( IrSpanVal[wl][n] - IrSpanVal[wl][n-1] );
	else	IrSlope[wl][n] = IrSpanBuf[wl][n] / IrSpanVal[wl][n];
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void IR430_Calibration( S16 Responsivity )
{
	double	fScale;
	S16		CalBuf[7], i;
		
	if( DeviceType == DTYPE_TRIPLE ){
		return;
	}
	
	fScale = (double)Responsivity / 1990;
	
	for( i=EEP_CAL_BUF_IR430_01; i<=EEP_CAL_BUF_IR430_07; i++ ){
		CalBuf[i-EEP_CAL_BUF_IR430_01] = (S16)((double)pgm_read_word( &EEP_SYS_DEFAULT[i] ) * fScale);
		epr_sm[i] = CalBuf[i-EEP_CAL_BUF_IR430_01];
		EEP_Wr( i, epr_sm[i] );
	}
	
	EEP_CRC_Wr(EEP_BLOCK_1);
	
	if( EEP_CRC_Check(EEP_BLOCK_1) ){
		EepErrorFlag = EEP_CAL_BUF_IR430_01;
	}
	else {
		EepErrorFlag = 0;
		
		for( i=EEP_CAL_BUF_IR430_01; i<=EEP_CAL_BUF_IR430_07; i++ ){
			IrSpanBuf[IR_WL_430][i-EEP_CAL_BUF_IR430_01] = ((double)pgm_read_word( &EEP_SYS_DEFAULT[i] ) * 0.001);
		}
		for( i=0; i<7; i++ ){
			IR_Slope_Calculator( IR_WL_430, i );
		}
	}
	
	sTimerFlag[TMR_MODBUS_TIMEOUT] = 0;
}
